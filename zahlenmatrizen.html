<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Zahlenmatrix Rechner</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #eef2f6;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    .container {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      text-align: center;
    }

    h2 {
      margin-bottom: 1rem;
    }

    .controls {
      margin-bottom: 1rem;
    }

    .matrix {
      display: grid;
      gap: 8px;
      margin: 1rem 0;
      justify-content: center;
    }

    .matrix input {
      width: 60px;
      height: 50px;
      font-size: 1.1rem;
      text-align: center;
      border: 2px solid #ccc;
      border-radius: 6px;
    }

    button {
      padding: 0.7rem 1.2rem;
      font-size: 1rem;
      border: none;
      background-color: #4caf50;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }

    button:hover {
      background-color: #45a046;
    }

    .output {
      margin-top: 1rem;
      font-size: 1.2rem;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Zahlenmatrix l√∂sen</h2>
    <div class="controls">
      <label for="size">Matrixgr√∂√üe:</label>
      <select id="size" onchange="createMatrix()">
        <option value="3">3√ó3</option>
        <option value="4">4√ó4</option>
        <option value="5">5√ó5</option>
      </select>
    </div>
    <div id="matrix" class="matrix"></div>
    <button onclick="berechneMatrix()">Berechnen</button>
    <div class="output" id="output"></div>
  </div>

  <script>
    let matrixSize = 3;

    function createMatrix() {
      matrixSize = parseInt(document.getElementById("size").value);
      const matrixContainer = document.getElementById("matrix");
      matrixContainer.innerHTML = "";
      matrixContainer.style.gridTemplateColumns = `repeat(${matrixSize}, 60px)`;

      for (let i = 0; i < matrixSize * matrixSize; i++) {
        const input = document.createElement("input");
        input.id = `cell${i}`;
        input.placeholder = i + 1;
        matrixContainer.appendChild(input);
      }
    }

    function parseInput(val) {
      val = val.trim();
      if (val === "?") return null;
      if (val.includes("/")) {
        const [num, den] = val.split("/").map(Number);
        return den ? num / den : NaN;
      }
      return parseFloat(val);
    }

    function berechneMatrix() {
      const output = document.getElementById("output");
      const cells = Array.from({ length: matrixSize * matrixSize }, (_, i) => document.getElementById(`cell${i}`).value.trim());
      const zahlen = cells.map(parseInput);
      const fehlendIndex = zahlen.findIndex(v => v === null);

      if (fehlendIndex === -1) {
        output.textContent = "‚ùó Bitte ein Feld mit ? markieren.";
        return;
      }

      const result = findeWert(zahlen, fehlendIndex);

      if (result !== null && !isNaN(result)) {
        const gerundet = Number.isInteger(result) ? result : result.toFixed(2);
        output.textContent = `üß† Fehlender Wert: ${gerundet}`;
      } else {
        output.textContent = "‚ùó Kein klares Muster erkannt.";
      }
    }

    function findeWert(zahlen, ziel) {
      const reihen = [];

      // Zeilen
      for (let r = 0; r < matrixSize; r++) {
        const start = r * matrixSize;
        reihen.push(Array.from({ length: matrixSize }, (_, i) => start + i));
      }

      // Spalten
      for (let c = 0; c < matrixSize; c++) {
        reihen.push(Array.from({ length: matrixSize }, (_, i) => c + i * matrixSize));
      }

      // Diagonalen (nur bei quadratischer Matrix sinnvoll)
      if (matrixSize === 3 || matrixSize === 4 || matrixSize === 5) {
        reihen.push(Array.from({ length: matrixSize }, (_, i) => i * (matrixSize + 1)));
        reihen.push(Array.from({ length: matrixSize }, (_, i) => (i + 1) * (matrixSize - 1)));
      }

      for (let gruppe of reihen) {
        if (!gruppe.includes(ziel)) continue;
        const werte = gruppe.map(i => zahlen[i]);
        if (werte.filter(v => v === null).length !== 1) continue;

        const idx = gruppe.indexOf(ziel);
        const bekannte = werte.filter(v => v !== null);
        if (bekannte.length < 2) continue;

        const [a, b, c] = werte;

        // Regelversuche
        if (idx === 2 && a !== null && b !== null) return a + b;
        if (idx === 0 && b !== null && c !== null) return c - b;
        if (idx === 1 && a !== null && c !== null) return (a + c) / 2;
        if (idx === 2 && a !== null && b !== null) return a * b;
        if (idx === 0 && b !== 0 && c !== null) return c / b;
      }

      return null;
    }

    // Initiale Matrix
    createMatrix();
  </script>
</body>
</html>
