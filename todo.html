<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Moderne ToDo App mit Erinnerungen</title>

<!-- FullCalendar -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<style>
  body {
    margin: 0;
    font-family: "Segoe UI", sans-serif;
    background: linear-gradient(-45deg, #74ABE2, #5563DE, #6dd5ed, #2193b0);
    background-size: 400% 400%;
    animation: gradientBG 12s ease infinite;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 20px;
    min-height: 100vh;
  }
  @keyframes gradientBG {
    0% {background-position: 0% 50%;}
    50% {background-position: 100% 50%;}
    100% {background-position: 0% 50%;}
  }

  .container {
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    padding: 0;
    width: 100%;
    max-width: 1100px;
    overflow: hidden;
  }

  .header {
    background: #5563DE;
    color: white;
    padding: 20px;
    text-align: center;
  }
  .header img {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 10px;
    border: 3px solid white;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  }
  h1 { margin: 0; font-size: 1.6rem; }

  .content {
    padding: 20px;
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
  }

  /* Input-Formular */
  .input-form {
    display: none;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 20px;
  }
  .input-form input, .input-form select {
    padding: 10px;
    border: 2px solid #ccc;
    border-radius: 8px;
    font-size: 1rem;
  }
  .input-form input:focus, .input-form select:focus {
    border-color: #5563DE;
    outline: none;
  }

  button {
    background: #5563DE;
    color: white;
    border: none;
    padding: 10px 16px;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.3s ease, transform 0.1s ease;
  }
  button:hover { background: #4450b0; }
  button:active { transform: scale(0.95); }

  .views {
    display: flex;
    gap: 20px;
    flex: 1;
    flex-wrap: wrap;
  }
  .list-view, .calendar-view {
    flex: 1;
    min-width: 300px;
  }

  ul {
    list-style: none;
    padding: 0;
    margin-top: 20px;
  }
  li {
    background: #f8f8f8;
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border: 1px solid #eee;
    flex-wrap: wrap;
    transition: all 0.3s ease;
  }

  .todo-info { flex: 1; min-width: 200px; }
  .todo-title { font-weight: bold; }
  .todo-date { font-size: 0.85rem; color: #666; }

  .status {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 0.85rem;
    margin-top: 4px;
  }
  .status-offen { background: #ffefc1; color: #a67c00; }
  .status-erledigt { background: #c1ffd7; color: #006633; }
  .status-urgent { background: #ffcccc; color: #cc0000; }

  .actions button { margin-left: 5px; padding: 6px 8px; font-size: 0.9rem; }

  .overdue { border-color: #ff4d4d !important; background: #ffe5e5 !important; }

  .filter-container {
    display: flex;
    gap: 10px;
    align-items: center;
    margin-top: 10px;
    flex-wrap: wrap;
  }
  .filter-container label { font-weight: bold; }

  .weekend-day { background-color: #f0f0f0 !important; }
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="https://image.pngaaa.com/561/898561-middle.png" alt="Logo" />
      <h1>Meine To-Do's</h1>
    </div>
    <div class="content">
      <div style="flex:1 1 100%;">
        <button id="show-form-btn">➕ Hinzufügen</button>
        <div class="input-form" id="input-form">
          <input type="text" id="todo-input" placeholder="Titel eingeben..." />
          <input type="date" id="todo-date" />
          <div style="display:flex; gap:10px;">
            <input type="time" id="todo-start" /> 
            <input type="time" id="todo-end" />
          </div>
          <select id="todo-status">
            <option value="offen">Offen</option>
            <option value="erledigt">Erledigt</option>
          </select>
          <label>
            <input type="checkbox" id="todo-urgent" /> Dringlich
          </label>
          <div style="display:flex; gap:10px;">
            <button id="save-btn">Speichern</button>
            <button id="cancel-btn" type="button">Abbrechen</button>
            <button id="delete-btn" type="button" style="display:none; background:#ff4d4d;">Löschen</button>
          </div>
        </div>
      </div>

      <div class="views">
        <div class="list-view">
          <h3>Listenansicht</h3>
          <div class="filter-container">
            <label for="filter-date">Datum:</label>
            <input type="date" id="filter-date" />
            <label for="filter-status">Status:</label>
            <select id="filter-status">
              <option value="alle">Alle</option>
              <option value="offen">Offen</option>
              <option value="erledigt">Erledigt</option>
            </select>
            <button id="clear-filter">Alle anzeigen</button>
          </div>
          <ul id="todo-list"></ul>
        </div>
        <div class="calendar-view">
          <h3>Kalenderansicht</h3>
          <div id="calendar"></div>
        </div>
      </div>
    </div>
  </div>

<script>
const showFormBtn = document.getElementById('show-form-btn');
const form = document.getElementById('input-form');
const saveBtn = document.getElementById('save-btn');
const cancelBtn = document.getElementById('cancel-btn');
const deleteFormBtn = document.getElementById('delete-btn');
const input = document.getElementById('todo-input');
const dateInput = document.getElementById('todo-date');
const startInput = document.getElementById('todo-start');
const endInput = document.getElementById('todo-end');
const statusInput = document.getElementById('todo-status');
const urgentInput = document.getElementById('todo-urgent');
const todoList = document.getElementById('todo-list');

const filterDateInput = document.getElementById('filter-date');
const filterStatusInput = document.getElementById('filter-status');
const clearFilterBtn = document.getElementById('clear-filter');

let editId = null;
let todos = (JSON.parse(localStorage.getItem('todos')) || []).map(t => ({ ...t, id: String(t.id) }));

// Kalender init
let calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
  initialView: 'dayGridMonth',
  locale: 'de',
  height: 500,
  events: [],
  dayCellClassNames: function(arg) {
    const day = arg.date.getDay(); 
    if (day === 0 || day === 6) return ['weekend-day'];
    return [];
  },
  eventDidMount: function(info) {
    let tooltip = document.createElement("div");
    tooltip.style.position = "absolute";
    tooltip.style.zIndex = "1000";
    tooltip.style.background = "#333";
    tooltip.style.color = "#fff";
    tooltip.style.padding = "6px 10px";
    tooltip.style.borderRadius = "8px";
    tooltip.style.fontSize = "0.85rem";
    tooltip.style.whiteSpace = "nowrap";
    tooltip.style.pointerEvents = "none";
    tooltip.style.display = "none";

    tooltip.innerHTML = `
      <b>${info.event.title}</b><br>
      ${info.event.start ? info.event.start.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"}) : ""}
      ${info.event.end ? " - " + info.event.end.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"}) : ""}
    `;

    document.body.appendChild(tooltip);

    info.el.addEventListener("mouseenter", e => {
      tooltip.style.display = "block";
      tooltip.style.top = (e.pageY + 10) + "px";
      tooltip.style.left = (e.pageX + 10) + "px";
    });
    info.el.addEventListener("mousemove", e => {
      tooltip.style.top = (e.pageY + 10) + "px";
      tooltip.style.left = (e.pageX + 10) + "px";
    });
    info.el.addEventListener("mouseleave", () => {
      tooltip.style.display = "none";
    });
  }
});
calendar.render();

showFormBtn.addEventListener('click', () => { form.style.display = 'flex'; showFormBtn.style.display = 'none'; });
cancelBtn.addEventListener('click', resetForm);
saveBtn.addEventListener('click', handleSave);
filterDateInput.addEventListener('change', renderTodos);
filterStatusInput.addEventListener('change', renderTodos);
clearFilterBtn.addEventListener('click', () => {
  filterDateInput.value = '';
  filterStatusInput.value = 'alle';
  renderTodos();
});

// **Lösch-Button funktioniert jetzt**
deleteFormBtn.addEventListener('click', () => {
  if (!editId) return;
  if (confirm("Wirklich löschen?")) {
    todos = todos.filter(t => String(t.id) !== String(editId));
    saveTodos();
    renderTodos();
    resetForm();
  }
});

function handleSave() {
  const text = input.value.trim();
  const date = dateInput.value;
  const start = startInput.value;
  const end = endInput.value;
  const status = statusInput.value;
  const urgent = urgentInput.checked;

  if (!text || !date) { alert("Titel und Datum sind Pflicht!"); return; }

  if (editId !== null) {
    todos = todos.map(t => String(t.id) === String(editId) ? { ...t, text, date, start, end, status, urgent } : t);
    editId = null;
  } else {
    todos.push({ id: String(Date.now() + Math.random()), text, date, start, end, status, urgent });
  }

  saveTodos();
  renderTodos();
  resetForm();
}

function resetForm() {
  form.style.display = 'none';
  showFormBtn.style.display = 'inline-block';
  input.value = '';
  dateInput.value = '';
  startInput.value = '';
  endInput.value = '';
  statusInput.value = 'offen';
  urgentInput.checked = false;
  editId = null;
  deleteFormBtn.style.display = 'none';
}

function saveTodos() { localStorage.setItem('todos', JSON.stringify(todos)); }

function renderTodos() {
  todoList.innerHTML = '';
  calendar.removeAllEvents();
  const filterDate = filterDateInput.value;
  const filterStatus = filterStatusInput.value;

  todos.forEach(todo => {
    if ((filterDate && todo.date !== filterDate) || (filterStatus !== 'alle' && todo.status !== filterStatus)) return;

    const li = document.createElement('li');
    if (todo.status === 'offen' && new Date(todo.date) < new Date()) li.classList.add('overdue');

    const infoDiv = document.createElement('div');
    infoDiv.classList.add('todo-info');
    infoDiv.innerHTML = `<div class="todo-title">${todo.text}</div>
      <div class="todo-date">${todo.date} ${todo.start||''} ${todo.end||''}</div>
      <div class="status ${todo.urgent?'status-urgent':todo.status==='offen'?'status-offen':'status-erledigt'}">
        ${todo.urgent?'Dringlich':todo.status}
      </div>`;

    const actionsDiv = document.createElement('div');
    actionsDiv.classList.add('actions');

    const editBtn = document.createElement('button');
    editBtn.textContent = '✏️';
    editBtn.addEventListener('click', () => startEdit(todo.id));
    actionsDiv.appendChild(editBtn);

    li.appendChild(infoDiv);
    li.appendChild(actionsDiv);
    todoList.appendChild(li);

    let start = todo.date + (todo.start ? 'T'+todo.start : '');
    let end = todo.date + (todo.end ? 'T'+todo.end : '');
    calendar.addEvent({ id: todo.id, title: todo.text, start, end, color: todo.urgent ? '#ff4d4d' : (todo.status==='offen'?'#5563DE':'#c1ffd7') });
  });
}

function startEdit(id) {
  const todo = todos.find(t => String(t.id)===String(id));
  input.value = todo.text;
  dateInput.value = todo.date;
  startInput.value = todo.start||'';
  endInput.value = todo.end||'';
  statusInput.value = todo.status;
  urgentInput.checked = todo.urgent||false;
  form.style.display='flex';
  showFormBtn.style.display='none';
  editId = String(id);
  deleteFormBtn.style.display = 'inline-block';
}

renderTodos();
</script>
</body>
</html>
