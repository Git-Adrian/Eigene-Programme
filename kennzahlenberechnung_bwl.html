<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BWL-Kennzahlenrechner</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f8fa;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 1rem;
    }
    .container {
      background: #fff;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 700px;
    }
    h2 {
      text-align: center;
      color: #333;
    }
    label, select, input {
      display: block;
      width: 100%;
      margin-top: 1rem;
      font-size: 1rem;
    }
    input, select {
      padding: 0.6rem;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    button {
      margin-top: 1.5rem;
      width: 100%;
      padding: 0.8rem;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    .result {
      margin-top: 1.5rem;
      padding: 1rem;
      background: #e8f4ff;
      border-left: 5px solid #007bff;
      border-radius: 8px;
      color: #333;
      white-space: pre-wrap;
    }
    .hidden {
      display: none;
    }
    .formel-box {
      margin-top: 1rem;
      background: #f9f9f9;
      padding: 0.8rem;
      border-left: 4px solid #007bff;
      border-radius: 8px;
      font-style: italic;
      color: #444;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>BWL-Kennzahlenrechner</h2>
    <label for="kennzahl">Kennzahl auswählen:</label>
    <select id="kennzahl" onchange="zeigeEingabefelder()">
      <option value="">-- Bitte wählen --</option>

      <optgroup label="Kapitalstruktur">
        <option value="ekquote">Eigenkapitalquote</option>
        <option value="fkquote">Fremdkapitalquote</option>
        <option value="verschuldungsgrad">Verschuldungsgrad</option>
        <option value="selbstfinanzierungsgrad">Selbstfinanzierungsgrad</option>
        <option value="ruecklagenquote">Rücklagenquote</option>
        <option value="deckungsgrad_a">Deckungsgrad A</option>
        <option value="deckungsgrad_b">Deckungsgrad B</option>
        <option value="deckungsgrad_c">Deckungsgrad C</option>
        <option value="anlagedeckung1">Anlagedeckungsgrad I</option>
        <option value="anlagedeckung2">Anlagedeckungsgrad II</option>
      </optgroup>

      <optgroup label="Rentabilität">
        <option value="ekrentabilitaet">Eigenkapitalrentabilität</option>
        <option value="umsatzrentabilitaet">Umsatzrentabilität</option>
        <option value="gesamtkapitalrentabilitaet">Gesamtkapitalrentabilität</option>
      </optgroup>

      <optgroup label="Liquidität">
        <option value="liquid1">Liquidität 1. Grades</option>
        <option value="liquid2">Liquidität 2. Grades</option>
      </optgroup>

      <optgroup label="Vermögensstruktur">
        <option value="anlagenintensitaet">Anlagenintensität</option>
        <option value="umlaufintensitaet">Umlaufintensität</option>
        <option value="vorratsintensitaet">Vorratsintensität</option>
      </optgroup>

      <optgroup label="Investitionskennzahlen">
        <option value="investitionsquote">Investitionsquote</option>
        <option value="investitionsdeckung">Investitionsdeckung</option>
        <option value="abschreibungsquote">Abschreibungsquote</option>
      </optgroup>

      <optgroup label="Umschlagshäufigkeiten">
        <option value="umschlag_anlagevermoegen">Umschlaghäufigkeit des Anlagevermögens</option>
        <option value="umschlag_umlaufvermoegen">Umschlaghäufigkeit des Umlaufvermögens</option>
        <option value="umschlag_gesamtvermoegen">Umschlaghäufigkeit des Gesamtvermögens</option>
        <option value="laufzeit_forderungen">Laufzeit der Forderungen (Tage)</option>
      </optgroup>

      <optgroup label="Cashflow / Finanzierung">
        <option value="cashflow_engeren_sinn">Cashflow im engeren Sinne</option>
        <option value="cashflow_weiteren_sinn">Cashflow im weiteren Sinne</option>
        <option value="innenfinanzierungsgrad">Innenfinanzierungsgrad</option>
        <option value="dynamischer_verschuldungsgrad">Dynamischer Verschuldungsgrad</option>
        <option value="bruttocashflow">Bruttocashflow</option>
        <option value="cashflow_laufende_geschaeftstaetigkeit">Cashflow aus laufender Geschäftigkeit</option>
        <option value="cashflow_investitionstaetigkeit">Cashflow aus der Investitionstätigkeit</option>
        <option value="cashflow_finanzierungstaetigkeit">Cashflow aus der Finanzierungstätigkeit</option>
      </optgroup>
    </select>

    <div id="eingabefelder"></div>
    <div id="formel" class="formel-box hidden"></div>
    <button onclick="berechneKennzahl()">Berechnen</button>
    <div id="ergebnis" class="result hidden"></div>
  </div>

<script>
// (Das kennzahlen-Objekt bleibt unverändert, nur hier zur Vollständigkeit eingebunden)
const kennzahlen = {
  anlagedeckung1: {
    name: "Anlagedeckungsgrad I",
    inputs: ["Eigenkapital", "Anlagevermögen"],
    formel: "Anlagedeckungsgrad I = (Eigenkapital / Anlagevermögen) × 100",
    berechnung: ({eigenkapital, anlagevermögen}) => (eigenkapital / anlagevermögen) * 100,
    interpret: val => val >= 100 
      ? "✅ Ausreichende Deckung des Anlagevermögens durch Eigenkapital." 
      : "⚠️ Anlagevermögen ist nicht vollständig durch Eigenkapital gedeckt."
  },
  anlagedeckung2: {
    name: "Anlagedeckungsgrad II",
    inputs: ["Eigenkapital", "Langfristiges Fremdkapital", "Anlagevermögen"],
    formel: "Anlagedeckungsgrad II = (Eigenkapital + langfristiges Fremdkapital) / Anlagevermögen × 100",
    berechnung: ({eigenkapital, langfristiges_fremdkapital, anlagevermögen}) => ((eigenkapital + langfristiges_fremdkapital) / anlagevermögen) * 100,
    interpret: val => val >= 100 
      ? "✅ Anlagevermögen ist langfristig finanziert (Goldene Bilanzregel erfüllt)." 
      : "⚠️ Anlagevermögen ist nicht vollständig langfristig finanziert."
  },
  liquid1: {
    name: "Liquidität 1. Grades",
    inputs: ["Zahlungsmittel", "Kurzfristige Verbindlichkeiten"],
    formel: "Liquidität 1. Grades = Zahlungsmittel / kurzfristige Verbindlichkeiten × 100",
    berechnung: ({zahlungsmittel, kurzfristige_verbindlichkeiten}) => (zahlungsmittel / kurzfristige_verbindlichkeiten) * 100,
    interpret: val => val >= 100 
      ? "✅ Kurzfristige Verbindlichkeiten können sofort beglichen werden." 
      : "⚠️ Geringe Liquidität – Zahlungsschwierigkeiten möglich."
  },
  liquid2: {
    name: "Liquidität 2. Grades",
    inputs: ["Zahlungsmittel", "Forderungen", "Kurzfristige Verbindlichkeiten"],
    formel: "Liquidität 2. Grades = (Zahlungsmittel + Forderungen) / kurzfristige Verbindlichkeiten × 100",
    berechnung: ({zahlungsmittel, forderungen, kurzfristige_verbindlichkeiten}) => ((zahlungsmittel + forderungen) / kurzfristige_verbindlichkeiten) * 100,
    interpret: val => val >= 120 
      ? "✅ Solide Liquiditätslage." 
      : "⚠️ Liquidität ist verbesserungswürdig."
  },
  ekquote: {
    name: "Eigenkapitalquote",
    inputs: ["Eigenkapital", "Gesamtkapital"],
    formel: "Eigenkapitalquote = Eigenkapital / Gesamtkapital × 100",
    berechnung: ({eigenkapital, gesamtkapital}) => (eigenkapital / gesamtkapital) * 100,
    interpret: val => val >= 30 
      ? "✅ Solide Eigenkapitalbasis." 
      : "⚠️ Niedrige Eigenkapitalquote – erhöhtes Insolvenzrisiko."
  },
  fkquote: {
    name: "Fremdkapitalquote",
    inputs: ["Fremdkapital", "Gesamtkapital"],
    formel: "Fremdkapitalquote = Fremdkapital / Gesamtkapital × 100",
    berechnung: ({fremdkapital, gesamtkapital}) => (fremdkapital / gesamtkapital) * 100,
    interpret: val => val <= 70
      ? "✅ Angemessene Fremdkapitalquote."
      : "⚠️ Hohe Verschuldung."
  },
  ekrentabilitaet: {
    name: "Eigenkapitalrentabilität",
    inputs: ["Jahresüberschuss", "Eigenkapital"],
    formel: "Eigenkapitalrentabilität = Jahresüberschuss / Eigenkapital × 100",
    berechnung: ({jahresueberschuss, eigenkapital}) => (jahresueberschuss / eigenkapital) * 100,
    interpret: val => val >= 8
      ? "✅ Gute Rentabilität des Eigenkapitals."
      : "⚠️ Niedrige Eigenkapitalrentabilität."
  },
  umsatzrentabilitaet: {
    name: "Umsatzrentabilität",
    inputs: ["Jahresüberschuss", "Umsatzerlöse"],
    formel: "Umsatzrentabilität = Jahresüberschuss / Umsatzerlöse × 100",
    berechnung: ({jahresueberschuss, umsatzerloese}) => (jahresueberschuss / umsatzerloese) * 100,
    interpret: val => val >= 5
      ? "✅ Gute Rentabilität des Umsatzes."
      : "⚠️ Niedrige Umsatzrentabilität."
  },
  anlagenintensitaet: {
    name: "Anlagenintensität",
    inputs: ["Anlagevermögen", "Gesamtvermögen"],
    formel: "Anlagenintensität = Anlagevermögen / Gesamtvermögen × 100",
    berechnung: ({anlagevermoegen, gesamtvermoegen}) => (anlagevermoegen / gesamtvermoegen) * 100,
    interpret: val => val <= 50
      ? "✅ Angemessene Anlagenintensität."
      : "⚠️ Hoher Anteil Anlagevermögen."
  },
  umlaufintensitaet: {
    name: "Umlaufintensität",
    inputs: ["Umlaufvermögen", "Gesamtvermögen"],
    formel: "Umlaufintensität = Umlaufvermögen / Gesamtvermögen × 100",
    berechnung: ({umlaufvermoegen, gesamtvermoegen}) => (umlaufvermoegen / gesamtvermoegen) * 100,
    interpret: val => val >= 50
      ? "✅ Angemessene Umlaufintensität."
      : "⚠️ Geringer Umlaufvermögensanteil."
  },
  vorratsintensitaet: {
    name: "Vorratsintensität",
    inputs: ["Vorräte", "Gesamtvermögen"],
    formel: "Vorratsintensität = Vorräte / Gesamtvermögen × 100",
    berechnung: ({vorraete, gesamtvermoegen}) => (vorraete / gesamtvermoegen) * 100,
    interpret: val => val <= 30
      ? "✅ Angemessener Vorratsanteil."
      : "⚠️ Hoher Vorratsanteil."
  },
  investitionsquote: {
    name: "Investitionsquote",
    inputs: ["Investitionen", "Anlagevermögen"],
    formel: "Investitionsquote = Investitionen / Anlagevermögen × 100",
    berechnung: ({investitionen, anlagevermoegen}) => (investitionen / anlagevermoegen) * 100,
    interpret: val => val >= 10
      ? "✅ Angemessene Investitionstätigkeit."
      : "⚠️ Niedrige Investitionsquote."
  },
  investitionsdeckung: {
    name: "Investitionsdeckung",
    inputs: ["Abschreibungen", "Investitionen"],
    formel: "Investitionsdeckung = Abschreibungen / Investitionen × 100",
    berechnung: ({abschreibungen, investitionen}) => (abschreibungen / investitionen) * 100,
    interpret: val => val >= 100
      ? "✅ Investitionen werden durch Abschreibungen gedeckt."
      : "⚠️ Investitionen übersteigen Abschreibungen."
  },
  abschreibungsquote: {
    name: "Abschreibungsquote",
    inputs: ["Abschreibungen", "Anlagevermögen"],
    formel: "Abschreibungsquote = Abschreibungen / Anlagevermögen × 100",
    berechnung: ({abschreibungen, anlagevermoegen}) => (abschreibungen / anlagevermoegen) * 100,
    interpret: val => val >= 5
      ? "✅ Angemessene Abschreibungsquote."
      : "⚠️ Niedrige Abschreibungsquote."
  },
  umschlag_anlagevermoegen: {
    name: "Umschlaghäufigkeit des Anlagevermögens",
    inputs: ["Umsatzerlöse", "Anlagevermögen"],
    formel: "Umschlaghäufigkeit Anlagevermögen = Umsatzerlöse / Anlagevermögen",
    berechnung: ({umsatzerloese, anlagevermoegen}) => umsatzerloese / anlagevermoegen,
    interpret: val => val >= 1
      ? "✅ Anlagevermögen wird häufig genutzt."
      : "⚠️ Geringe Umschlaghäufigkeit."
  },
  umschlag_umlaufvermoegen: {
    name: "Umschlaghäufigkeit des Umlaufvermögens",
    inputs: ["Umsatzerlöse", "Umlaufvermögen"],
    formel: "Umschlaghäufigkeit Umlaufvermögen = Umsatzerlöse / Umlaufvermögen",
    berechnung: ({umsatzerloese, umlaufvermoegen}) => umsatzerloese / umlaufvermoegen,
    interpret: val => val >= 3
      ? "✅ Umlaufvermögen wird häufig umgesetzt."
      : "⚠️ Geringe Umschlaghäufigkeit."
  },
  umschlag_gesamtvermoegen: {
    name: "Umschlaghäufigkeit des Gesamtvermögens",
    inputs: ["Umsatzerlöse", "Gesamtvermögen"],
    formel: "Umschlaghäufigkeit Gesamtvermögen = Umsatzerlöse / Gesamtvermögen",
    berechnung: ({umsatzerloese, gesamtvermoegen}) => umsatzerloese / gesamtvermoegen,
    interpret: val => val >= 1.5
      ? "✅ Gesamtvermögen wird effizient genutzt."
      : "⚠️ Geringe Umschlaghäufigkeit."
  },
  laufzeit_forderungen: {
    name: "Laufzeit der Forderungen (Tage)",
    inputs: ["Forderungen", "Umsatzerlöse"],
    formel: "Laufzeit Forderungen = (Forderungen / Umsatzerlöse) × 360",
    berechnung: ({forderungen, umsatzerloese}) => (forderungen / umsatzerloese) * 360,
    interpret: val => val <= 30
      ? "✅ Forderungen werden zügig beglichen."
      : "⚠️ Lange Forderungslaufzeit."
  },
  ruecklagenquote: {
    name: "Rücklagenquote",
    inputs: ["Rücklagen", "Eigenkapital"],
    formel: "Rücklagenquote = Rücklagen / Eigenkapital × 100",
    berechnung: ({ruecklagen, eigenkapital}) => (ruecklagen / eigenkapital) * 100,
    interpret: val => val >= 20
      ? "✅ Solide Rücklagenbasis."
      : "⚠️ Niedrige Rücklagenquote."
  },
  selbstfinanzierungsgrad: {
    name: "Selbstfinanzierungsgrad",
    inputs: ["Gewinnrücklagen", "Jahresüberschuss"],
    formel: "Selbstfinanzierungsgrad = Gewinnrücklagen / Jahresüberschuss × 100",
    berechnung: ({gewinnruecklagen, jahresueberschuss}) => (gewinnruecklagen / jahresueberschuss) * 100,
    interpret: val => val >= 50
      ? "✅ Hoher Selbstfinanzierungsgrad."
      : "⚠️ Geringer Selbstfinanzierungsgrad."
  },
  verschuldungsgrad: {
    name: "Verschuldungsgrad",
    inputs: ["Fremdkapital", "Eigenkapital"],
    formel: "Verschuldungsgrad = Fremdkapital / Eigenkapital × 100",
    berechnung: ({fremdkapital, eigenkapital}) => (fremdkapital / eigenkapital) * 100,
    interpret: val => val <= 100
      ? "✅ Geringe Verschuldung."
      : "⚠️ Hohe Verschuldung."
  },
  gesamtkapitalrentabilitaet: {
    name: "Gesamtkapitalrentabilität",
    inputs: ["Jahresüberschuss", "Fremdkapitalzins", "Gesamtkapital"],
    formel: "Gesamtkapitalrentabilität = (Jahresüberschuss + Fremdkapitalzins) / Gesamtkapital × 100",
    berechnung: ({jahresueberschuss, fremdkapitalzins, gesamtkapital}) => ((jahresueberschuss + fremdkapitalzins) / gesamtkapital) * 100,
    interpret: val => val >= 8
      ? "✅ Gute Gesamtkapitalrentabilität."
      : "⚠️ Niedrige Rentabilität."
  },
  deckungsgrad_a: {
    name: "Deckungsgrad A",
    inputs: ["Eigenkapital", "Anlagevermögen"],
    formel: "Deckungsgrad A = Eigenkapital / Anlagevermögen × 100",
    berechnung: ({eigenkapital, anlagevermoegen}) => (eigenkapital / anlagevermoegen) * 100,
    interpret: val => val >= 50
      ? "✅ Guter Deckungsgrad A."
      : "⚠️ Geringer Deckungsgrad A."
  },
  deckungsgrad_b: {
    name: "Deckungsgrad B",
    inputs: ["Eigenkapital", "Langfristiges Fremdkapital", "Anlagevermögen"],
    formel: "Deckungsgrad B = (Eigenkapital + langfristiges Fremdkapital) / Anlagevermögen × 100",
    berechnung: ({eigenkapital, langfristiges_fremdkapital, anlagevermoegen}) => ((eigenkapital + langfristiges_fremdkapital) / anlagevermoegen) * 100,
    interpret: val => val >= 100
      ? "✅ Guter Deckungsgrad B."
      : "⚠️ Geringer Deckungsgrad B."
  },
  deckungsgrad_c: {
    name: "Deckungsgrad C",
    inputs: ["Eigenkapital", "Langfristiges Fremdkapital", "Anlagevermögen", "Umlaufvermögen"],
    formel: "Deckungsgrad C = (Eigenkapital + langfristiges Fremdkapital) / (Anlagevermögen + Umlaufvermögen) × 100",
    berechnung: ({eigenkapital, langfristiges_fremdkapital, anlagevermoegen, umlaufvermoegen}) =>
      ((eigenkapital + langfristiges_fremdkapital) / (anlagevermoegen + umlaufvermoegen)) * 100,
    interpret: val => val >= 100
      ? "✅ Guter Deckungsgrad C."
      : "⚠️ Geringer Deckungsgrad C."
  },
  cashflow_engeren_sinn: {
    name: "Cashflow im engeren Sinne",
    inputs: ["Jahresüberschuss", "Abschreibungen"],
    formel: "Cashflow im engeren Sinne = Jahresüberschuss + Abschreibungen",
    berechnung: ({jahresueberschuss, abschreibungen}) => jahresueberschuss + abschreibungen,
    interpret: val => val > 0
      ? "✅ Positiver Cashflow im engeren Sinne."
      : "⚠️ Negativer Cashflow im engeren Sinne."
  },
  cashflow_weiteren_sinn: {
    name: "Cashflow im weiteren Sinne",
    inputs: ["Jahresüberschuss", "Abschreibungen", "Veränderung Rückstellungen"],
    formel: "Cashflow im weiteren Sinne = Jahresüberschuss + Abschreibungen + Veränderung Rückstellungen",
    berechnung: ({jahresueberschuss, abschreibungen, veraenderung_rueckstellungen}) =>
      jahresueberschuss + abschreibungen + veraenderung_rueckstellungen,
    interpret: val => val > 0
      ? "✅ Positiver Cashflow im weiteren Sinne."
      : "⚠️ Negativer Cashflow im weiteren Sinne."
  },
  innenfinanzierungsgrad: {
    name: "Innenfinanzierungsgrad",
    inputs: ["Cashflow", "Investitionen"],
    formel: "Innenfinanzierungsgrad = Cashflow / Investitionen × 100",
    berechnung: ({cashflow, investitionen}) => (cashflow / investitionen) * 100,
    interpret: val => val >= 100
      ? "✅ Investitionen werden vollständig aus Innenfinanzierung gedeckt."
      : "⚠️ Investitionen nicht vollständig aus Innenfinanzierung gedeckt."
  },
  dynamischer_verschuldungsgrad: {
    name: "Dynamischer Verschuldungsgrad",
    inputs: ["Fremdkapital", "Cashflow"],
    formel: "Dynamischer Verschuldungsgrad = Fremdkapital / Cashflow",
    berechnung: ({fremdkapital, cashflow}) => fremdkapital / cashflow,
    interpret: val => val <= 3
      ? "✅ Gute Verschuldungssituation."
      : "⚠️ Hohe Verschuldung."
  },
  bruttocashflow: {
    name: "Bruttocashflow",
    inputs: ["Jahresüberschuss", "Abschreibungen"],
    formel: "Bruttocashflow = Jahresüberschuss + Abschreibungen",
    berechnung: ({jahresueberschuss, abschreibungen}) => jahresueberschuss + abschreibungen,
    interpret: val => val > 0
      ? "✅ Positiver Bruttocashflow."
      : "⚠️ Negativer Bruttocashflow."
  },
  cashflow_laufende_geschaeftstaetigkeit: {
    name: "Cashflow aus laufender Geschäftstätigkeit",
    inputs: ["Einzahlungen aus laufender Geschäftstätigkeit", "Auszahlungen aus laufender Geschäftstätigkeit"],
    formel: "Cashflow laufende Geschäftstätigkeit = Einzahlungen - Auszahlungen",
    berechnung: ({einzahlungen, auszahlungen}) => einzahlungen - auszahlungen,
    interpret: val => val > 0
      ? "✅ Positiver Cashflow aus laufender Geschäftstätigkeit."
      : "⚠️ Negativer Cashflow aus laufender Geschäftstätigkeit."
  },
  cashflow_investitionstaetigkeit: {
    name: "Cashflow aus der Investitionstätigkeit",
    inputs: ["Einzahlungen aus Investitionstätigkeit", "Auszahlungen aus Investitionstätigkeit"],
    formel: "Cashflow Investitionstätigkeit = Einzahlungen - Auszahlungen",
    berechnung: ({einzahlungen, auszahlungen}) => einzahlungen - auszahlungen,
    interpret: val => val >= 0
      ? "✅ Positiver oder ausgeglichener Cashflow aus Investitionstätigkeit."
      : "⚠️ Negativer Cashflow aus Investitionstätigkeit (normal bei Investitionen)."
  },
  cashflow_finanzierungstaetigkeit: {
    name: "Cashflow aus der Finanzierungstätigkeit",
    inputs: ["Einzahlungen aus Finanzierungstätigkeit", "Auszahlungen aus Finanzierungstätigkeit"],
    formel: "Cashflow Finanzierungstätigkeit = Einzahlungen - Auszahlungen",
    berechnung: ({einzahlungen, auszahlungen}) => einzahlungen - auszahlungen,
    interpret: val => val >= 0
      ? "✅ Positiver oder ausgeglichener Cashflow aus Finanzierungstätigkeit."
      : "⚠️ Negativer Cashflow aus Finanzierungstätigkeit."
  }
};

function zeigeEingabefelder() {
  const kennzahl = document.getElementById("kennzahl").value;
  const feld = document.getElementById("eingabefelder");
  const formelDiv = document.getElementById("formel");
  const ergebnisDiv = document.getElementById("ergebnis");

  feld.innerHTML = "";
  formelDiv.classList.add("hidden");
  ergebnisDiv.classList.add("hidden");

  if (!kennzahl || !kennzahlen[kennzahl]) return;

  const k = kennzahlen[kennzahl];

  k.inputs.forEach(name => {
    const id = name.toLowerCase().replace(/\s+/g, "_").replace(/ä/g, "ae").replace(/ö/g,"oe").replace(/ü/g,"ue").replace(/ß/g,"ss");
    feld.innerHTML += `
      <label for="${id}">${name} (€):</label>
      <input type="number" id="${id}" placeholder="${name}" min="0" step="0.01" />
    `;
  });

  formelDiv.textContent = "Formel: " + k.formel;
  formelDiv.classList.remove("hidden");
}

function berechneKennzahl() {
  const kennzahl = document.getElementById("kennzahl").value;
  const ergebnisDiv = document.getElementById("ergebnis");

  if (!kennzahl || !kennzahlen[kennzahl]) {
    ergebnisDiv.textContent = "❗ Bitte eine Kennzahl auswählen.";
    ergebnisDiv.classList.remove("hidden");
    return;
  }

  const k = kennzahlen[kennzahl];
  let inputsValid = true;
  let inputValues = {};

  k.inputs.forEach(name => {
    const id = name.toLowerCase().replace(/\s+/g, "_").replace(/ä/g, "ae").replace(/ö/g,"oe").replace(/ü/g,"ue").replace(/ß/g,"ss");
    const val = parseFloat(document.getElementById(id).value);
    if (isNaN(val)) inputsValid = false;
    inputValues[id] = val;
  });

  if (!inputsValid) {
    ergebnisDiv.textContent = "❗ Bitte alle Eingaben korrekt ausfüllen.";
    ergebnisDiv.classList.remove("hidden");
    return;
  }

  // Anpassung der Keys für Berechnung
  let params = {};
  for (const key in inputValues) {
    params[key] = inputValues[key];
  }

  try {
    let wert = k.berechnung(params);
    if (!isFinite(wert)) throw new Error("Ungültige Berechnung");
    let interpretation = k.interpret(wert);

    ergebnisDiv.innerHTML = `<strong>Ergebnis:</strong> ${typeof wert === "number" && !Number.isInteger(wert) ? wert.toFixed(2) : wert} ${k.formel.includes("× 100") ? "%" : ""}\n\n<strong>Beurteilung:</strong>\n${interpretation}`;
  } catch(e) {
    ergebnisDiv.textContent = "❗ Fehler bei der Berechnung. Bitte Eingaben prüfen.";
  }
  ergebnisDiv.classList.remove("hidden");
}
</script>
</body>
</html>
